<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.
    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.
    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base
    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="HV LINE - 실시간 선 그리기 도구">
  
  <!-- 캐시 방지 메타 태그 -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- 버전 정보 -->
  <meta name="app-version" content="1.0.0">
  <meta name="build-time" content="2024-12-20">
  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="HV LINE">
  
  <!-- iOS PWA 권한 관련 메타 태그 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  
  <!-- iOS 미디어 권한 힌트 -->
  <meta name="permissions-policy" content="microphone=(self)">
  
  <!-- iOS 홈화면 아이콘 (여러 크기 지원) -->
  <link rel="apple-touch-icon" href="icons/Icon-192.png?v=2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/Icon-192.png?v=2.0">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/Icon-192.png?v=2.0">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/Icon-192.png?v=2.0">
  
  <!-- 아이콘 프리로드로 캐시 강제 갱신 -->
  <link rel="preload" as="image" href="icons/Icon-192.png?v=2.0">
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png?v=2.0"/>
  <link rel="shortcut icon" type="image/png" href="favicon.png?v=2.0"/>
  <title>HV LINE</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- 추가 캐시 방지 -->
  <script>
    // 페이지 로드 시 캐시 무효화
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
        }
      });
    }
    
    // 카카오톡 인앱 브라우저 감지 및 캐시 우회
    const isKakaoTalk = /KAKAOTALK/i.test(navigator.userAgent);
    if (isKakaoTalk) {
      // 캐시 무효화를 위한 타임스탬프 추가
      const timestamp = new Date().getTime();
      const currentUrl = new URL(window.location);
      if (!currentUrl.searchParams.has('_t')) {
        currentUrl.searchParams.set('_t', timestamp.toString());
        window.history.replaceState({}, '', currentUrl.toString());
      }
    }
  </script>
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
  
  <!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
  import { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';
  
  const firebaseConfig = {
    apiKey: "AIzaSyCQ1_7hbvODByDihzdPe0bAg8r7zLRPMeo",
    authDomain: "hv-line.firebaseapp.com",
    databaseURL: "https://hv-line-default-rtdb.firebaseio.com",
    projectId: "hv-line",
    storageBucket: "hv-line.firebasestorage.app",
    messagingSenderId: "651342907657",
    appId: "1:651342907657:web:2ce01d847b0bef45752bd8"
  };
  
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  window.firebase = { app, database };
</script>
</body>
</html>